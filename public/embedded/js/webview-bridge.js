var SlaxReaderWebBridgeExports=function(e){"use strict";function t(){return window.NativeBridge?.postMessage?"android":window.webkit?.messageHandlers?.NativeBridge?"ios":"unknown"}function n(e){const n=JSON.stringify(e),r=t();return"android"===r?(window.NativeBridge.postMessage(n),!0):"ios"===r&&(window.webkit.messageHandlers.NativeBridge.postMessage(n),!0)}function r(){return Math.max(document.body.scrollHeight,document.body.offsetHeight,document.documentElement.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight)}function o(e){const t=e.tagName.toLowerCase();if("img"===t){const t=e;return t.currentSrc||t.src||""}if("image"===t){const t=e;return t.href?.baseVal||e.getAttribute("href")||e.getAttribute("xlink:href")||""}return""}function i(){const e=document.querySelectorAll("img, image");e.forEach(t=>{t.style.cssText="",t.addEventListener("click",t=>{const r=Array.from(e).map(o).filter(e=>e&&(e.startsWith("https://")||e.startsWith("http://"))),i=o(t.currentTarget);n({type:"imageClick",src:i,allImages:r,index:r.indexOf(i)})})})}function a(e){let t=null,n=null;if(e instanceof HTMLElement||null===e?t=e:(t=e.element||null,n=e.range||null),t||n)try{const e=window.getSelection();!n&&t&&(n=document.createRange(),n.selectNodeContents(t)),e&&n&&(e.removeAllRanges(),e.addRange(n))}catch(e){}}function s(e){return e.split("").reverse().join("")}function c(e){return(e|-e)>>31&1}function d(e,t,n,r){let o=e.P[n],i=e.M[n];const a=r>>>31,s=t[n]|a,d=s|i,l=(s&o)+o^o|s;let u=i|~(l|o),f=o&l;const g=c(u&e.lastRowMask[n])-c(f&e.lastRowMask[n]);return u<<=1,f<<=1,f|=a,u|=c(r)-a,o=f|~(d|u),i=u&d,e.P[n]=o,e.M[n]=i,g}function l(e,t,n){if(0===t.length)return[];n=Math.min(n,t.length);const r=[],o=32,i=Math.ceil(t.length/o)-1,a={P:new Uint32Array(i+1),M:new Uint32Array(i+1),lastRowMask:new Uint32Array(i+1)};a.lastRowMask.fill(1<<31),a.lastRowMask[i]=1<<(t.length-1)%o;const s=new Uint32Array(i+1),c=new Map,l=[];for(let e=0;e<256;e++)l.push(s);for(let e=0;e<t.length;e+=1){const n=t.charCodeAt(e);if(c.has(n))continue;const r=new Uint32Array(i+1);c.set(n,r),n<l.length&&(l[n]=r);for(let e=0;e<=i;e+=1){r[e]=0;for(let i=0;i<o;i+=1){const a=e*o+i;if(a>=t.length)continue;t.charCodeAt(a)===n&&(r[e]|=1<<i)}}}let u=Math.max(0,Math.ceil(n/o)-1);const f=new Uint32Array(i+1);for(let e=0;e<=u;e+=1)f[e]=(e+1)*o;f[i]=t.length;for(let e=0;e<=u;e+=1)a.P[e]=-1,a.M[e]=0;for(let g=0;g<e.length;g+=1){const h=e.charCodeAt(g);let m;h<l.length?m=l[h]:(m=c.get(h),void 0===m&&(m=s));let w=0;for(let e=0;e<=u;e+=1)w=d(a,m,e,w),f[e]+=w;if(f[u]-w<=n&&u<i&&(1&m[u+1]||w<0)){let e;if(u+=1,a.P[u]=-1,a.M[u]=0,u===i){const n=t.length%o;e=0===n?o:n}else e=o;f[u]=f[u-1]+e-w+d(a,m,u,w)}else for(;u>0&&f[u]>=n+o;)u-=1;u===i&&f[u]<=n&&(f[u]<n&&r.splice(0,r.length),r.push({start:-1,end:g+1,errors:f[u]}),n=f[u])}return r}function u(e,t,n){return function(e,t,n){const r=s(t);return n.map(n=>{const o=Math.max(0,n.end-t.length-n.errors);return{start:l(s(e.slice(o,n.end)),r,n.errors).reduce((e,t)=>n.end-t.end<e?n.end-t.end:e,n.end),end:n.end,errors:n.errors}})}(e,t,l(e,t,n))}var f,g,h,m={},w={};function p(){return f||(f=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e,a){if(e.whatToShow!==i){var c;try{c=new DOMException(n,"InvalidStateError")}catch(e){(c=new Error(n)).code=11,c.name="InvalidStateError",c.toString=function(){return"InvalidStateError: ".concat(n)}}throw c}var d=0,l=e.referenceNode,u=null;if(f=a,"number"==typeof f&&isFinite(f)&&Math.floor(f)===f)u={forward:function(){return d<a},backward:function(){return d>a||!e.pointerBeforeReferenceNode}};else{if(!s(a))throw new TypeError(r);u={forward:function(e,t){return e.compareDocumentPosition(t)&o}(l,a)?function(){return!1}:function(){return l!==a},backward:function(){return l!==a||!e.pointerBeforeReferenceNode}}}var f;for(;u.forward();){if(null===(l=e.nextNode()))throw new RangeError(t);d+=l.nodeValue.length}e.nextNode()&&(l=e.previousNode());for(;u.backward();){if(null===(l=e.previousNode()))throw new RangeError(t);d-=l.nodeValue.length}if(!s(e.referenceNode))throw new RangeError(t);return d};var t="Iterator exhausted before seek ended.",n="Argument 1 of seek must use filter NodeFilter.SHOW_TEXT.",r="Argument 2 of seek must be an integer or a Text Node.",o=2,i=4,a=3;function s(e){return e.nodeType===a}}(w)),w}var E,v,y,N,M={};function S(){return E||(E=1,function(e){function t(e,t){if(!t&&e.firstChild)return e.firstChild;do{if(e.nextSibling)return e.nextSibling;e=e.parentNode}while(e);return e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(e){var n="";return function(e,n){var r=function(e){if(e.startContainer.nodeType===Node.ELEMENT_NODE){return e.startContainer.childNodes[e.startOffset]||t(e.startContainer,!0)}return e.startContainer}(e),o=function(e){if(e.endContainer.nodeType===Node.ELEMENT_NODE){return e.endContainer.childNodes[e.endOffset]||t(e.endContainer,!0)}return t(e.endContainer)}(e);for(;r!==o;)n(r),r=t(r)}(e,function(t){if(t.nodeType===Node.TEXT_NODE){var r=t===e.startContainer?e.startOffset:0,o=t===e.endContainer?e.endOffset:t.textContent.length;n+=t.textContent.slice(r,o)}}),n}}(M)),M}function C(){if(v)return m;v=1,Object.defineProperty(m,"__esModule",{value:!0}),m.fromRange=function(e,n){if(void 0===e)throw new Error('missing required parameter "root"');if(void 0===n)throw new Error('missing required parameter "range"');var r=e.ownerDocument.createRange(),o=n.startContainer,i=n.startOffset;r.setStart(e,0),r.setEnd(o,i);var a=(0,t.default)(r).length,s=a+(0,t.default)(n).length;return{start:a,end:s}},m.toRange=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===t)throw new Error('missing required parameter "root"');var o=t.ownerDocument,i=o.createRange(),a=o.createNodeIterator(t,r),s=n.start||0,c=n.end||s,d=s-(0,e.default)(a,s),l=a.referenceNode,u=c-s+d,f=u-(0,e.default)(a,u),g=a.referenceNode;return i.setStart(l,d),i.setEnd(g,f),i};var e=n(h?g:(h=1,g=p().default)),t=n(S());function n(e){return e&&e.__esModule?e:{default:e}}var r=4;return m}var x=N?y:(N=1,y=C());function b(e){const t=e.trim().replace(/\s+/g," ");try{const e=function(e,t,n=!0){const r=e.trim().replace(/\s+/g," "),o=n?Math.max(3,Math.floor(r.length/3)):0,i={candidate:null};return function e(t){if(t.nodeType===Node.ELEMENT_NODE){const a=t;if(("undefined"==typeof navigator||!navigator.userAgent.includes("jsdom"))&&0===a.offsetHeight&&0===a.offsetWidth)return;const s=a.textContent,{text:c,ranges:d}=function(e){const t=[];return{text:e.replace(/(\s+)|([^\s])/g,(e,n,r,o)=>(t.push({start:o,end:o+e.length}),n?" ":e)),ranges:t}}(s||"");if(s&&s.length>=r.length-o){const e=u(c,r,o);if(e.length>0){e.sort((e,t)=>e.errors-t.errors);const t=e[0];if(!i.candidate||t.errors<i.candidate.errors||t.errors===i.candidate.errors&&s.length<=i.candidate.length){const e=d[t.start].start,n=d[t.end-1].end;i.candidate={element:a,errors:t.errors,length:s.length,match:{start:e,end:n,errors:t.errors}}}}else if(n){const e=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\s+/g,"\\s+"),t=new RegExp(e,"i"),n=s.match(t);n&&void 0!==n.index&&(i.candidate={element:a,errors:0,length:s.length,match:{start:n.index,end:n.index+n[0].length,errors:0}})}}Array.from(a.children).forEach(t=>e(t))}}(document.body),i.candidate?{element:i.candidate.element,match:i.candidate.match}:null}(t);if(e){const{element:t,match:n}=e,r=x.toRange(t,{start:n.start,end:n.end});if(r){let e=r.commonAncestorContainer;return e.nodeType===Node.TEXT_NODE&&e.parentNode&&(e=e.parentNode),{element:e||t,range:r}}}}catch(e){}return null}function T(e){if(!e)return;const r=t();if("android"===r){const t=e.getBoundingClientRect(),r=window.pageYOffset||document.documentElement.scrollTop;n({type:"scrollToPosition",percentage:(t.top+r)/Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)})}else"ios"===r&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}function A(e){const t=b(decodeURIComponent(e));return!!t&&(T(t.element),a(t),!0)}function R(){const e=document.querySelector("body > .slax-reader-notfound-container > .slax-reader-notfound-btn-container");if(!e)return;const t=e.querySelector(".retry-btn"),r=e.querySelector(".feedback-btn");t&&t.addEventListener("click",()=>{n({type:"refreshContent"})}),r&&r.addEventListener("click",()=>{n({type:"feedback"})})}return e.SlaxWebViewBridge=class{constructor(){this.postMessage=n,this.getContentHeight=r,this.scrollToAnchor=A,this.highlightElement=a,this.findMatchingElement=b,this.scrollToElement=T,this.init()}init(){window.CSS&&window.CSS.escape||(window.CSS=window.CSS||{},window.CSS.escape=function(e){if(0===arguments.length)throw new TypeError("`CSS.escape` requires an argument.");for(var t,n=String(e),r=n.length,o=-1,i="";++o<r;)0!==(t=n.charCodeAt(o))?i+=t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95===t||45===t?n.charAt(o):"\\"+n.charAt(o):i+="ï¿½";return i}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{i(),R()}):(i(),R())}},e}({});window.SlaxWebViewBridge=new SlaxReaderWebBridgeExports.SlaxWebViewBridge;
